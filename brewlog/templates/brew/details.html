{% extends "brew/base.html" %}
{% import "macros/forms.html" as forms %}

{% block scripts %}
{% if not user.is_anonymous() %}
<script type="text/javascript" src="/static/js/jquery.jeditable.min.js"></script>
<script type="text/javascript">
$(document).ready(function() {
    var notes = {{ notes|safe }};
    $(".edit_area").editable("{{ url_for('tastingnote.update') }}", {
        type: "textarea",
        loadurl: "{{ url_for('tastingnote.loadtext') }}",
        cancel: "<button type='cancel' class='button tiny radius'>{{ gettext('cancel') }}</button>",
        submit: "<button type='submit' class='button tiny radius'>{{ gettext('send') }}</button>"
    });
})
</script>
{% endif %}
{% endblock %}

{% block topmenu_right %}
<li class="has-dropdown"><a href="#">{% trans %}recipe tools{% endtrans %}</a>
    <ul class="dropdown">
        <li><a href="{{ url_for('brew.print', brew_id=brew.id) }}">{{ gettext("print recipe") }}</a></li>
        <li><a href="{{ url_for('brew.labels', brew_id=brew.id) }}">{{ gettext("print labels") }}</a></li>
        <li class="has-dropdown"><a href="#">{{ gettext("export recipe") }}</a>
            <ul class="dropdown">
                <li><a href="{{ url_for('brew.export', flavour='ipboard', brew_id=brew.id) }}">IP.Board</a></li>
            </ul>
        </li>
    </ul>
</li>
{% endblock %}

{% block headpagetitle %}{{ super() }} {% if brew.code %}#{{ brew.code }} {% endif %}{{ brew.name|e }}{% endblock %}

{% block headdescription %}{{ brew.brew_description }}{% endblock %}

{% block content %}
{% if form %}
<dl class="accordion" data-accordion>
<dd class="accordion-navigation">
<a href="#panel-fermentation-data">{{ gettext("fermentation data").capitalize() }}</a>
<div id="panel-fermentation-data" class="content">
{% for fstep in brew.fermentation_steps.all() %}
{% include "brew/include/fermentation_step.html" %}
{% endfor %}
<p><a href="{{ url_for('brew.fermentationstep_add', brew_id=brew.id) }}" class="button small radius">{{ gettext("add fermentation step") }}</a></p>
</div>
</dd>
</dl>
{% endif %}
{% include "brew/include/details.html" %}
{% if brew.tasting_notes %}
{% include "tasting/include/tasting_notes.html" %}
{% endif %}
{% if user.is_authenticated() and brew.is_brewed_yet %}
<p><a href="{{ url_for('tastingnote.add', brew_id=brew.id) }}" class="button small radius">{{ gettext("add tasting note") }}</a></p>
{% endif %}
{% if form %}
<h3>{{ gettext("edit brew").capitalize() }}</h3>
<form method="post" action="{{ brew.absolute_url }}" class="custom">
    {{ forms.render(form) }}
</form>
{% endif %}
{% endblock %}
